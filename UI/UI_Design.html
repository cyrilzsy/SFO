<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Staple Food Ordinance</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

  <link   rel="stylesheet" type="text/css" href="css/UI_Design.css"/>
 </head>

<body data-spy="scroll" data-target="#myNavbar" data-offset="50">

<nav class="navbar navbar-expand navbar-inverse" id="myNavbar">
  <ul class="nav nav-pills">
    <li class="dropdown" id="menuDropdown" style="display: inline">
      <a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" style="font-size:125%; color: white">
        <span class="glyphicon glyphicon-menu-hamburger" id="hamburger_menu"></span>
      </a>
      <ul class="dropdown-menu">
        <li><a style="font-size:100%" href="#helpModal" data-toggle="modal" id="helpMenu">Help</a></li>
        <li class="divider"></li>
        <li><a style="font-size:100%" href="#infoModal" data-toggle="modal">Info</a></li>
        <li><a style="font-size:100%" href="#acknModal" data-toggle="modal">Acknowledgements</a></li>
        <!-- See index.html in ContraceptiveDT for an example of a hopscotch tour -->
      </ul>
    </li>

    <li>
      <span style="color: white; font-size:200%">Staple Food Ordinance Model</span>
    </li>
  </ul>
</nav>

<div id="debugText"></div>

<!-- Modal -->
<div id="infoModal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h3 class="modal-title">Staple Food Ordinance Model</h3>
      </div>
      <div class="modal-body">
        <h4>Scientific authors and contributors:</h4>
        <h4>Joel Gittelsohn, PhD</h4>
        <h4>Lisa Poirier, MPH</h4>
        <h4>[others]</h4>
        <h4>[including Baltimore City collaborators]</h4>
        <br />
        <h5>App designers:</h5>
        <h5>Siyao Zhu and Tak Igusa</h5>
        <br />

        <h4>DISCLAIMER</h4>
        <p>
          The Authors provides the App and the services, information, content and/or data (collectively, “Information”) contained therein for informational purposes only.
        </p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<div id="acknModal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h3 class="modal-title">Staple Food Ordinance Model</h3>
      </div>
      <div class="modal-body">
        <h4>Acknowledgements</h4>
        <p>
          The development of this mobile web application was partially supported by ... . The content is solely the responsibility of the authors and does not necessarily represent the official views of ... or the Johns Hopkins University.
        </p>
        <h5>Suggested citation format</h5>
        <p>
          Gittelsohn, J, Poirier, L, Zhao, S and Igusa, T (2018). Staple Food Ordinance Model (Alpha Version 1.0). Johns Hopkins University, Baltimore, MD. [Mobile application software.] Available from: https://engineering.jhu.edu/tak/SFO
        </p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<div id="helpModal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h3 class="modal-title">Staple Food Ordinance Model: Help</h3>
      </div>
      <div class="modal-body">
        <div class="panel-group">
          <div class="panel-primary">
            <div class="panel-heading">Upper menu</div>
            <div class="panel-body">
              <h5>[header]</h5>
              <ul>
                <li>[list instructions and hints, and used <b>bold</b> when referring to sliders and buttons.]</li>
                <li>[continue the list]</li>
              </ul>
            </div>
          </div>
          <div class="panel-primary">
            <div class="panel-heading">Graphs</div>
            <div class="panel-body">
              <h5>Plot 1</h5>
              <ul>
                <li>[describe the first plot here]</li>
                <li>[more descripton]</li>
              </ul>
              <h5>Plot 2</h5>
              <ul>
                <li>[describe the second plot here]</li>
                <li>[more descripton]</li>
              </ul>
            </div>
          </div>
        </div>        
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<nav class="navbar navbar-inverse navbar-fixed-bottom navbar-expand-sm">
  <div class="container-fluid" id="accordion">
    <button class="navbar-toggler navbar-btn" type="button" data-toggle="collapse" data-parent="#accordion" data-target="#nav-content" aria-controls="nav-content"   aria-expanded="false" aria-label="Toggle-navigation" id="Choices_button"><b>Staple Food Selection</b></button>

    <button class="navbar-toggler navbar-btn" type="button" data-toggle="collapse" data-parent="#accordion" data-target="#nav-content-1" aria-controls="nav-content-1" aria-expanded="false" aria-label="Toggle-navigation" id="Patient_button"><b>Options [for future use]</b></button>
    <button class="navbar-btn" onclick="fReset(this)">
      <span class="glyphicon glyphicon-refresh"></span><b>Reset</b>
    </button>

    <button type="button" class="close" onclick="fClose()">
      <span style="color: #fff!important; opacity: 1!important;">&times;</span>
    </button>

    <div class="panel">
      <div class="collapse" id="nav-content">
      <form>
      <table style="width: 100%">
        <colgroup>
          <col style="background-color: beige">
          <col style="background-color: white">
          <col style="background-color: beige">
          <col style="background-color: white">
          <col style="background-color: beige">
        </colgroup>
        <thead>
          <tr>
            <th>Fruits & Vegetables</th>
            <th>Drinks</th>
            <th>Protein</th>
            <th>Bread</th>
            <th>Beans</th>
          </tr>
        </thead>
        <tbody id="checkboxTable">
          <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
        </tbody>
      </table>
      </form>
      </div>
    </div>

    <div class="panel">
      <div class="collapse" id="nav-content-1">
      <form>
        <label class="radio-inline">
          <input type="radio" id="SmokingYN"       name="choose"  onchange="updateSelect()" >Option A
        </label>
        <br />
        <label class="radio-inline">
          <input type="radio" id="HyptertensionYN" name="choose"  onchange="updateSelect()" >Option B
        </label>
        <label class="radio-inline">
          <input type="radio" id="ObeseYN"         name="choose"  onchange="updateSelect()" >Option C
        </label>
        <br />
      </form>
      </div>
    </div>
  </div>
</nav>

<div class="panel panel-success">
  <div class="panel-heading">
    <h2 class="panel-title" id="sliderPanel">Sliders for: </h2>
  </div>
  <div class="panel-body">
    <div class="row">
      <div class="col-sm-4">
        <div class="panel panel-danger">
          <div class="panel-heading">
            <h4 class="panel-title">Ordinance Characteristics</h4>
          </div>

          <div class="panel-body" id="setOrdinance">
          </div>
        </div>
      </div>

      <div class="col-sm-4">
        <div class="panel panel-warning">
          <div class="panel-heading">
            <h4 class="panel-title">Demand (Consumers)</h4>
          </div>

          <div class="panel-body" id="setDemand">
          </div>
        </div>
      </div>

      <div class="col-sm-4">
        <div class="panel panel-info">
          <div class="panel-heading">
            <h4 class="panel-title">Supply (Retail Food Store)</h4>
          </div>

          <div class="panel-body" id="setSupply">
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="panel panel-success">
  <div class="panel-heading">
    <h2 class="panel-title">Results</h2>
  </div>

  <div class="panel-body">
    <div class="row">
      <div class="col-sm-4">
        <div id="plot1"></div>
      </div>

      <div class="col-sm-4">
        <div id="plot2"></div>
      </div>

      <div class="col-sm-4">
        <div id="plot3"></div>
      </div>
    </div>

    <div class="row">
      <div class="col-sm-4">
        <div id="plot4"></div>
      </div>

      <div class="col-sm-4">
        <div id="plot5"></div>
      </div>

      <div class="col-sm-4">
        <div id="plot6"></div>
      </div>
    </div>

    <div class="row">
      <div class="col-sm-4">
        <div id="plot7"></div>
      </div>
    </div>
  </div>
</div>

<script>
  var myTable0 = document.getElementById("checkboxTable");
  var myTable  = myTable0.getElementsByTagName("td");
  var numNodes = myTable.length;
  var food = {
    names:  [["Bananas","Frozen Vegetables"],
             ["Fat Free Milk"],
             [],
             ["Whole Wheat Bread"],
             ["Low Sodium Canned Beans"]],
    numVars: [],
    results: [],
    vars:    [],
    plot:    [],
    select:  [0,0],
    numTypes: 0
  };
  food.numTypes = food.names.length;
  food.results  = Array(food.numTypes);

  var sliders = {
    defaultValues: [
                    [ [[0.5, 5,5,5],[5,5,5,5],[2,3,1,2]], [[0.6,10,5,5],[5,5,5,5],[2,3,1,2]] ],
                    [ [[0.6,10,5,5],[5,5,5,5],[2,3,1,2]] ],
                    [ [] ],
                    [ [[0.6,10,5,5],[5,5,5,5],[2,3,1,2]] ],
                    [ [[0.6,10,5,5],[5,5,5,5],[2,3,1,2]] ]
                   ],
    currentValues: [],
    typeNames:     ["Ordinance","Demand","Supply"],
    vars:         [["Enforcement","PromotionsOwners","PromotionsConsumers","MinimumStock"],
                   ["ConveniencePreparation","Taste","Affordability","Healthiness"],
                   ["InfrastructureCapacity","EaseDelivery","UnitCost","OptimalPrice"]],
    namesDisplay: [["Level of Enforcement","Promotions to Store Owners","Promotions to Consumers","Minimum Stock Required"],
                   ["Convenience of Preparation","Taste","Affordability","Healthiness"],
                   ["Infrastructure (storage) Capacity","Ease of Delivery","Unit Cost","Optimal Price on Hand"]],
    numVars:       [],
    valuesHTML:    [],
    slidersHTML:   [],
    numTypes:      0
  };
  sliders.currentValues = sliders.defaultValues;
  sliders.numTypes = sliders.vars.length;
  sliders.valuesHTML = Array(sliders.numTypes);
  sliders.sliderHTML = Array(sliders.numTypes);

function updateSelect() {
  food.plot = [];
  for (i=0; i<food.numTypes; i++) {
    for (j=0; j<food.numVars[i]; j++) {
      let foodVarNamei = food.vars[i][j];      
      if (document.getElementById("plot" + foodVarNamei).checked) {
        food.plot.push([i,j]);
      }
      if (document.getElementById("select" + foodVarNamei).checked) {
        food.select = [i,j];
      }
    }
  };
  for (i=0; i<sliders.numTypes; i++) {
    for (j=0; j<sliders.numVars[i]; j++) {
      let sliderValue = sliders.currentValues[food.select[0]][food.select[1]][i][j];
      sliders.valuesHTML[i][j].innerHTML = sliderValue;
      sliders.sliderHTML[i][j].value = sliderValue;
    }
  }  
}

$(document).ready(function(){
  for (i=0; i<food.numTypes; i++) {
    food.numVars[i] = food.names[i].length;
    food.results[i] = Array(food.numVars[i]);
    food.vars[i]    = Array(food.numVars[i]);
    for (j=0; j<food.numVars[i]; j++) {
      let foodNamei = food.names[i][j];
      let foodVarNamei = foodNamei.replace(/ /g,"");     // replace all " " with "" (remove blank spaces for variable names)
      food.vars[i][j] = foodVarNamei;
      let selectOption = '';
      if (i==0 && j==0) {
        selectOption = 'checked="checked"';
      }
      myTable[food.numTypes*j + i].innerHTML =
        '<div class="form-group"> \
          <input type="checkbox" id="plot' + foodVarNamei + '" autocomplete="off" onchange="updateSelect()" ' + selectOption + '/> \
          <div class="btn-group"> \
            <label for="plot' + foodVarNamei + '" class="btn btn-info"> \
              <span class="glyphicon glyphicon-ok"></span><span> </span> \
            </label> \
            <label for="plot' + foodVarNamei + '" class="btn btn-default active">' + foodNamei + '</label> \
          </div> \
          <input type="radio" id="select' + foodVarNamei + '" name="choose" onchange="updateSelect()" ' + selectOption + '> \
        </div >';
    }
  }
  document.getElementById("sliderPanel").innerHTML = 'Sliders for: ' + food.names[food.select[0]][food.select[1]];

  for (i=0; i<sliders.numTypes; i++) {
    let mySliders0 = document.getElementById("set" + sliders.typeNames[i]);
    sliders.numVars[i] = sliders.vars[i].length;
    sliders.valuesHTML[i] = Array(sliders.numVars[i]);
    sliders.sliderHTML[i] = Array(sliders.numVars[i]);
    slidersHTML = '';
    for (j=0; j<sliders.numVars[i]; j++) {
      let sliderNamei = sliders.namesDisplay[i][j];
      let sliderVarNamei = sliders.vars[i][j];
      slidersHTML = slidersHTML +
        '<div class="slidecontainer"> \
          <p>' + sliderNamei + ': <span id="value' + sliderVarNamei + '"></span></p> \
          <input type="range" min="0" max="10" value="' + sliders.defaultValues[food.select[0]][food.select[1]][i][j] + '" id="slider' + sliderVarNamei + '"> \
        </div >';
    }
    mySliders0.innerHTML = slidersHTML;
    for (j=0; j<sliders.numVars[i]; j++) {
      sliders.valuesHTML[i][j] = document.getElementById("value"  + sliders.vars[i][j]);
      sliders.sliderHTML[i][j] = document.getElementById("slider" + sliders.vars[i][j]);
      sliders.valuesHTML[i][j].innerHTML = sliders.defaultValues[food.select[0]][food.select[1]][i][j];
      sliders.sliderHTML[i][j].oninput = (function(e) {
        return function() {
          let sliderValue = sliders.sliderHTML[e[0]][e[1]].value;
          console.log(e + ", " + sliderValue);
          sliders.valuesHTML[e[0]][e[1]].innerHTML = sliderValue;                // e is set to i USE ONCHANGE?
          sliders.currentValues[food.select[0]][food.select[1]][e[0]][e[1]] = sliderValue;
          // sliders.valuesHTML[e[0]][e[1]].innerHTML = this.value;                // e is set to i USE ONCHANGE?
          // sliders.currentValues[food.select[0]][food.select[1]][e[0]][e[1]] = this.value;
          evalSliders(food.select);                          // food.select is used later
          updatePlot1(food.results);
        }
      })([i,j]);                                           // (i,j) is the argument, passed to (e)
    }
  }

  for (iFood1=0; iFood1<2; iFood1++) {
    let iFood0 = 0;
    evalSliders([iFood0,iFood1]);
    console.log(food.results[iFood0][iFood1]);
  }
  updatePlot1(food.results);

  // See ContraceptiveDT for scrollspy options

  // Add smooth scrolling on all links inside the navbar
  $("#myNavbar a").on('click', function(event) {
    // Make sure this.hash has a value before overriding default behavior
    if (this.hash !== "") {
      // Prevent default anchor click behavior
      event.preventDefault();

      // Store hash
      var hash = this.hash;

      // Using jQuery's animate() method to add smooth page scroll
      // The optional number (800) specifies the number of milliseconds it takes to scroll to the specified area
      $('html, body').animate({
        scrollTop: $(hash).offset().top
      }, 300, function(){
   
        // Add hash (#) to URL when done scrolling (default click behavior)
        window.location.hash = hash;
      });
    }
  });
});

</script>
<div class="slidecontainer">           <p>Level of Enforcement: <span id="valueEnforcement"></span></p>           <input min="0" max="10" value="undefined" id="sliderEnforcement" type="range">         </div>

<script src="js/UI_Design.js"></script>

</body>
</html>
