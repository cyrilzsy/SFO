// ODE solver for finding Y, S, M

// Variables for ODE
var t_max = 60;
var n_max = 50;
var j_max      = null;
var numFood = 22;
var S_actual_all = new Array(t_max).fill(0);
var t_ordinance = new Array(numFood).fill(0);
for (i=1; i<=numFood; i++) {
  t_ordinance[i] = 2*i + 1;
}

// var S_actual_all = [0];
// var Actual_Amount_in_Store = [1];           // need to initialize these for the ODE solver, runTime
// var Weekly_Consumer_Demand = [0];           // don't use new Array
// var Weekly_Profit = [0];

var z = {
  // Y_supply:  [0],
  // S_actual:  [2],
  // Y_demand:  [0],
  // Y_cust:    [0],
  // Y_waste:   [0],
  // M_profit:  [0],
  // M_storage: [0],
  // M_supply:  [0],
  // M_delivery:[0],
  // M_cust:    [0],
  price:     [0],
  Weekly_Profit:  [0],
  Weekly_Storage_Cost: [0],
  Weekly_Item_Cost:  [0],
  Weekly_Delivery_Cost:[0],
  Weekly_Revenue:    [0],
  Weekly_Amount_of_Supply:  [0],
  Actual_Amount_in_Store:  [0],
  Weekly_Consumer_Demand:  [0],
  Weekly_Amount_Sold:    [0],
  Weekly_Amount_Wasted:   [0],
  S_actual_end: [0],
  C_storage: [0]
};

for(var i=0; i<n_max; i++) {
  z.S_actual_end[i] = new Array(t_max).fill(0);
  z.Weekly_Amount_of_Supply[i] = new Array(t_max).fill(0);
  z.Weekly_Consumer_Demand[i] = new Array(t_max).fill(0);
  z.Weekly_Profit[i] = new Array(t_max).fill(0);
  z.Weekly_Storage_Cost[i] = new Array(t_max).fill(0);
  z.Weekly_Item_Cost[i] = new Array(t_max).fill(0);
  z.Weekly_Delivery_Cost[i] = new Array(t_max).fill(0);
  z.Weekly_Revenue[i] = new Array(t_max).fill(0);
  z.Actual_Amount_in_Store[i] = new Array(t_max).fill(0);
  z.Weekly_Amount_Sold[i] = new Array(t_max).fill(0);
  z.Weekly_Amount_Wasted[i] = new Array(t_max).fill(0);
  z.price[i] =  new Array(t_max).fill(0);
  // z.S_actual_all[i] = new Array(t_max).fill(0);
  z.C_storage[i] = new Array(t_max).fill(0);
  // S_actual_all[i] = new Array(t_max).fill(0);
  // for(var j=0; j<t_max; j++) {
  //
  // }
}



var zs = [];
var z_length = Object.keys(z).length;
// var z_plot   = Object.create(null);
var z_plot   = {
  num_plots: null
};

var Pars     = [
  [
    [0.0287,-0.0010,0.0535,-0.0015,4.53074401995793,0,	-0.135596536711833,	-0.232573497040552,	0.0282737367313996,	-0.187717066966688,( 4.53074401995793+	(-0.135596536711833	-0.232573497040552	+0.0282737367313996	-0.187717066966688)*5)/2.49/2, 2],    //Oranges·
    [0.0287,-0.0010,0.0535,-0.0015,0.155731609812880,0,	0.111414458784540,	0.0977965597314329,	0.0208058207059088,	-0.0801990350611959,( 0.155731609812880+(	0.111414458784540	+0.0977965597314329+	0.0208058207059088	-0.0801990350611959)*5)/1.49/2, 2],    //Carrots·
    [0.0287,-0.0010,0.0535,-0.0015,1.10017953692023,0,	0.367575953664011,	-0.237914596224992,	0.0660846005220913,	0.358786245491822,( 1.10017953692023+(	0.367575953664011	-0.237914596224992+	0.0660846005220913+	0.358786245491822)*5)/2.49/2, 2],    //Tomatoes·
    [0.0287,-0.0010,0.0535,-0.0015,0,0,	0.774453781512603,	0.522756302521011,	0,	0,( 0+	(0.774453781512603+	0.522756302521011+	0	+0)*5)/0.485/2, 2],    //Bananas·
    [0.2311,-0.0256,0.3443,-0.0291,3.43228999825567,0,	0.00743518685092698,	-0.466885997844958,	-0.124298829590199,	0.945706563995484,( 3.43228999825567+(	0.00743518685092698	-0.466885997844958	-0.124298829590199	+0.945706563995484)*5)/2.31625/2, 5],    //CFJ·
    [0.1455,-0.0062,0.3367,-0.0273,1.72097178603867,0,	0.0450928488116659,	-0.211366806617555,	0.360890187150656	,-0.0379651675962804,( 1.72097178603867+(	0.0450928488116659	-0.211366806617555+	0.360890187150656	-0.0379651675962804)*5)/2.41/2, 4],    // Broccoli·
    [0.0818, 0.0057,0.1688, 0.0125,5.33089755963051,0,	0.178615745208877,	-0.802771267061909,	-0.0537019164483673,	0.192609954501589,( 5.33089755963051	+(0.178615745208877	-0.802771267061909	-0.0537019164483673+	0.192609954501589)*5)/2.0625/2, 3]     //Lettuce·
  ],
  [
    [0.1468, 0.0047,0.3324, 0.0003,2.82192223423629,0,	-0.0981065188929706,	-0.791779991106505,	1.26979963800489,	0.272959590480958,(2.82192223423629+(	-0.0981065188929706	-0.791779991106505+	1.26979963800489	+0.272959590480958)*5)/1.59/2, 3],     //Whole Wheat Tortillas·
    [0.6882,-0.0976,0.3383, 0.0527,-16.6123481189984,0,	2.00934362502894,	-0.703324579538471,	-0.977981944300323,	4.15174865699758,( -16.6123481189984	+(2.00934362502894	-0.703324579538471	-0.977981944300323+	4.15174865699758)*5)/1.99/2, 6],    //Oatmeal·
    [0.6882,-0.0976,0.3383, 0.0527,2.08569195754603,0,	0.270944709873364	,0.286678456616116	,0.216253384113001	,-0.678766165720679,(2.08569195754603+(	0.270944709873364+	0.286678456616116+	0.216253384113001	-0.678766165720679)*5)/2.5/2, 6],    //Pasta·
    [0.1468, 0.0047,0.3324, 0.0003,3.34093457943926,0,	0.935327102803736	,-0.0381308411214949,	0.414953271028038,	-1.29084112149533,( 3.34093457943926	+(0.935327102803736	-0.0381308411214949	+0.414953271028038	-1.29084112149533)*5)/3.334, 3],     //Whole Wheat Bread·
    [0.6882,-0.0976,0.3383, 0.0527,2.08807862127902	,0,1.59353368466030,	0.223461045435121	,-0.798598490243554,	-0.0769292123629104,( 2.08807862127902+(	1.59353368466030	+0.223461045435121	-0.798598490243554	-0.0769292123629104)*5)/5.174/2, 6]     //Cereal·
  ],
  [
    [0.0507, 0.0498,0.3508, 0.0495,3.86808893351923,0,	0.518786986575151,	-2.74331926177964	,0.295916974583460,	3.39032231332443,( 3.86808893351923+(	0.518786986575151	-2.74331926177964+	0.295916974583460+	3.39032231332443)*5)/1.5/2, 3],     //Yogurt·
    [0.1378,-0.0017,0.3385,-0.0202,-0.907150056988622,0,	0.192481978013219	,0.252205105300795,	0.416748020855960,	1.64817282558557,( -0.907150056988622+(	0.192481978013219+	0.252205105300795+	0.416748020855960	+1.64817282558557)*5)/3.49/2, 3],     // Cheese·
    [0.0507, 0.0498,0.3508, 0.0495,-0.998315113368672,0,	-0.0315214590694938,	-0.299352179034157,	0.744313162544170,	1.10162415341578,( -0.998315113368672+(	-0.0315214590694938	-0.299352179034157	+0.744313162544170+	1.10162415341578)*5)/ 4.99333333333333/2, 3]     //FFM·
  ],
  [
    [0.1410,-0.0108,0.2881,-0.0252,-17.3552499868289,0,	-1.68695010800274,	-2.16690374585112,	6.41272851799167,	3.19846161951425,( -17.3552499868289+(	-1.68695010800274	-2.16690374585112+	6.41272851799167+	3.19846161951425)*5)/2.99/2, 2],    //Beef·
    [0.1410,-0.0108,0.2881,-0.0252,-3.24156388177799,0,	0.430311845473586,	-0.158377938096346,	0.213585059343728	,1.35895392134047,( -3.24156388177799	+(0.430311845473586	-0.158377938096346	+0.213585059343728+	1.35895392134047)*5)/5.99/2, 2],    //Poultry·
    [0.1410,-0.0108,0.2881,-0.0252,0.966984439124483,0,	-0.718534114227085,	0.576562500000000,	0.422759917920657,	0.728393254103967,( 0.966984439124483+(	-0.718534114227085+	0.576562500000000	+0.422759917920657+	0.728393254103967)*5)/1.874/2, 4],     //CT·
    [0.1378,-0.0017,0.3385,-0.0202,1.83650258013962,0,	1.20745691927204,	-0.376757422089965,	0.878137497148572,	-0.610115972572163,( 1.83650258013962+(	1.20745691927204	-0.376757422089965	+0.878137497148572	-0.610115972572163)*5)/ 2.61166666666667/2, 3]     // Eggs·
  ],
  [
    [0.1378,-0.0017,0.3385,-0.0202,10.1903497470238,0,	-0.452565535714285,	-0.874630297619047,	0.552929568452383	,-0.452153363095236,(10.1903497470238+(	-0.452565535714285	-0.874630297619047+	0.552929568452383	-0.452153363095236)*5)/ 2.5/2, 6],    //Peanut Butter
    // [0.1511,-0.0352,0.1864,-0.0352,3,0.14,0.18,0.15,0.18,0.13,3.875/2, 1],     //Peanut Butter
    [0.0507, 0.0498,0.3508, 0.0495,3,0.15,0.19,0.19,0.16,0.11,1.410/2, 3],     //Soymilk
    [0.1544,-0.0134,0.3464,-0.0375,2,0.18,0.11,0.20,0.14,0.19,1.350/2, 6]       //Canned Beans
  ]
];

// var Pars     = [
//                 [
//                   [0.0287,-0.0010,0.0535,-0.0015,0.473595619760833,0,0.351836355722728,	-0.109017113329515,	0.162598467972854,	0.0802717287836796,	0.248412118911758, 2],    //Oranges·
//                   [0.0287,-0.0010,0.0535,-0.0015,0.394185469386406,0,	0.142176496523570,	0.0497282210597168,	-0.0283786235096748,	-0.0303270223848078,	0.113451371888376, 2],    //Carrots·
//                   [0.0287,-0.0010,0.0535,-0.0015,2.21302780162014,0,	0.550961943676862,	-0.290690866941543,	0.0258022527661024,	0.187698944921093,	0.217271476115312, 2],    //Tomatoes·
//                   [0.0287,-0.0010,0.0535,-0.0015,0,	0,0, 0.971967188672094,	0.538164658377782,	0,	0,	0.485835112564496, 2],    //Bananas·
//                   [0.2311,-0.0256,0.3443,-0.0291,7.71027351305517,0,	-0.273721124539701,	-0.729650959667746,	-0.0595690825361149,	0.655270704781054,	0.388619345849074, 5],    //CFJ·
//                   [0.1455,-0.0062,0.3367,-0.0273,3.46114459948495,0,	0.310909768710009,	0.225929988655345,	0.259356646096747,	-0.779352605795300,	0.290277586813758, 4],    // Broccoli·
//                   [0.0818, 0.0057,0.1688, 0.0125,5.59608241921300,0,	0.184984144165693,	-0.815873396653467,	-0.0512426450112941,	0.162609545638055,	0.0417498094647477, 3]     //Lettuce·
//                 ],
//                 [
//                   [0.1468, 0.0047,0.3324, 0.0003,0.280697653280895,0,	0.592932601998337,	0.0172211829040871,	0.310078244562945,	0.739985583534254,	1.10947208356062, 3],     //Whole Wheat Tortillas·
//                   [0.6882,-0.0976,0.3383, 0.0527,-16.6345769870880,0,	2.07703830550811,	-0.717479700204089,	-0.972722674658944,	4.23183405038529,	0.264481653229408, 6],    //Oatmeal·
//                   [0.6882,-0.0976,0.3383, 0.0527,1.19799700048856,0,	0.468861749348521,	0.417384775481852,	0.140661532241267,	-0.504936712614168,	0.320089135002929, 6],    //Pasta·
//                   [0.1468, 0.0047,0.3324, 0.0003,2.26760142814080,0,	1.54946246553327,	-0.145113419483119,	0.212060701068475,	-0.994806706628751,	0.412994662951254, 3],     //Whole Wheat Bread·
//                   [0.6882,-0.0976,0.3383, 0.0527,3.13941505896490,0,	1.51997832711236,	0.0525530087796026,	-0.664468132362008,	-0.0163542120293086,	0.119566737781086, 6]     //Cereal·
//                 ],
//                 [
//                   [0.0507, 0.0498,0.3508, 0.0495,4.37590302145281,0,	1.14198150349487	,-2.28481510933138	,-0.379502410674275,	3.25829206682852,	1.37843615794836, 3],     //Yogurt·
//                   [0.1378,-0.0017,0.3385,-0.0202,-1.77812683364516,0,0.0166843687443128,	0.168016521370374	,0.538679182105058,	1.86543387811639,	-0.118247421546976, 3],     // Cheese·
//                   [0.0507, 0.0498,0.3508, 0.0495,-0.245485461182842,0,	0.268647234399070,	-0.200514279564030,	0.606711673810445,	0.823214602873922,	0.129939156805359, 3]     //FFM·
//                 ],
//                 [
//                   [0.1410,-0.0108,0.2881,-0.0252,-13.1335969482264,0,	-1.40445844342304,	-1.76681526140275,	5.29337978361709,	3.46384820608223,	0.732676611675065, 2],    //Beef·
//                   [0.1410,-0.0108,0.2881,-0.0252,-2.95112497656945,0,	0.467375204559659,	-0.214029591905538,	0.290214833140067,	1.29524475237364,	0.0358849980306023, 2],    //Poultry·
//                   [0.1410,-0.0108,0.2881,-0.0252,-0.608545025475003, 0,	-0.0705883891566383,	0.396922884761881,	0.434987231493302,	0.760642793651820,	0.360723460330377, 4],     //CT·
//                   [0.1378,-0.0017,0.3385,-0.0202,4.72812540329908,0,	0.931172226767697,	-0.421265639363210,	0.852170691554322,	-0.672965472001520,	0.320332971082146, 3]     // Eggs·
//                 ],
//                 [
//                   [0.1511,-0.0352,0.1864,-0.0352,8.32711042332598,0,	-0.273574626975317,	-0.777172614213133,	0.717429220345046,	-0.337178775809174,	0.181097837037839, 1],     //Peanut Butter
//                   // [0.0507, 0.0498,0.3508, 0.0495,0,0,	0,	0.400000000000000,	0,	0,	0, 3],     //Soymilk
//                   // [0.1544,-0.0134,0.3464,-0.0375,0,0,	0.587412587412588,	0	-0.349650349650350,	0.0979020979020979,	-3.01895690141170e-16,6]       //Canned Beans
//                   // [0.1511,-0.0352,0.1864,-0.0352,3,0.14,0.18,0.15,0.18,0.13,3.875, 1],     //Peanut Butter
//     [0.0507, 0.0498,0.3508, 0.0495,3,0.15,0.19,0.19,0.16,0.11,1.410, 3],     //Soymilk
//     [0.1544,-0.0134,0.3464,-0.0375,2,0.18,0.11,0.20,0.14,0.19,1.350, 6]       //Canned Beans
//                 ]
//                ];

// var Pars     = [
//   [
//     [0.0287,-0.0010,0.0535,-0.0015,1.18398904940208,0,0.879590889306821,-0.272542783323787, 0.406496169932136,	0.200679321959199,	0.621030297279396, 2],    //Oranges·
//     // [0.0287,-0.0010,0.0535,-0.0015,-16.5178402214775,2.79508364248950/2, 2.79508364248950/2,-0.479453242578706,0.554963737373109,1.10808182780980,( -16.5178402214775+(2.79508364248950/2+ 2.79508364248950/2-0.479453242578706+0.554963737373109+1.99362694396789+1.10808182780980)*5)/2.49, 2],
//     [0.0287,-0.0010,0.0535,-0.0015,0.563122099123437,0,	0.203109280747958,	0.0710403157995955,	-0.0405408907281069,	-0.0433243176925827,	0.162073388411966, 2],    //Carrots·
//     // [0.0287,-0.0010,0.0535,-0.0015,-2.66175447624987,1.20106762729864/2, 1.20106762729864/2,0.574998419056799,-0.276278219836149,-0.166004705759214,( -2.66175447624987+(1.20106762729864/2+1.20106762729864/2+0.574998419056799-0.276278219836149+0.890020868450260-0.166004705759214)*5)/1.49, 2],
//     [0.0287,-0.0010,0.0535,-0.0015,0.632293657605755,0,	0.157417698193389,	-0.0830545334118695,	0.00737207221888639,	0.0536282699774551,	0.0620775646043748, 2],    //Tomatoes·
//     [0.0287,-0.0010,0.0535,-0.0015,0,	0.303739746460029,0,	0.168176455743057,	0,	0,	0.151823472676405, 2],    //Bananas·
//     [0.2311,-0.0256,0.3443,-0.0291,3.85513675652759,0,	-0.136860562269851,	-0.364825479833873,	-0.0297845412680575,	0.327635352390527,	0.194309672924537, 5],    //CFJ·
//     [0.1455,-0.0062,0.3367,-0.0273,2.91464808377680,0,	0.261818752597902,	0.190256832551870,	0.218405596713050,	-0.656296931196043,	0.244444283632639, 4],    // Broccoli·
//     [0.0818, 0.0057,0.1688, 0.0125,3.73072161280867,0,	0.123322762777129,	-0.543915597768978,	-0.0341617633408626,	0.108406363758703,	0.0278332063098318, 3]     //Lettuce·
//   ],
//   [
//     [0.1468, 0.0047,0.3324, 0.0003,0.111476431009093,0,	0.235477602064471,	0.00683923070059042,	0.123144656299820,	0.293878309584692,	0.440616395377531, 3],     //Whole Wheat Tortillas·
//     [0.6882,-0.0976,0.3383, 0.0527,-6.16095443966223,0,	0.769273446484484,	-0.265733222297811,	-0.360267657281091,	1.56734594458714,	0.0979561678627438, 6],    //Oatmeal·
//     [0.6882,-0.0976,0.3383, 0.0527,1.19799700048856,0,	0.468861749348521,	0.417384775481852,	0.140661532241267,	-0.504936712614168,	0.320089135002929, 6],    //Pasta·
//     [0.1468, 0.0047,0.3324, 0.0003,1.25977857118933,0,	0.860812480851819,	-0.0806185663795108,	0.117811500593597,	-0.552670392571528,	0.229441479417363, 3],     //Whole Wheat Bread·
//     [0.6882,-0.0976,0.3383, 0.0527,0.976489909475863,0,	0.472777084638370,	0.0163461924664393,	-0.206677490625819,	-0.00508684666541481,	0.0371902761371963, 6]     //Cereal·
//   ],
//   [
//     [0.0507, 0.0498,0.3508, 0.0495,2.18795151072640,0,	0.570990751747433,	-1.14240755466569,	-0.189751205337138,	1.62914603341426,	0.689218078974180, 3],     //Yogurt·
//     [0.1378,-0.0017,0.3385,-0.0202,-0.889063416822582,0,	0.00834218437215638,	0.0840082606851869,	0.269339591052529,	0.932716939058193,	-0.0591237107734882, 3],     // Cheese·
//     [0.0507, 0.0498,0.3508, 0.0495,-0.125889980093765,0,	0.137767812512343,	-0.102827835673862,	0.311134191697664,	0.422161334807140,	0.0666354650283891, 3]     //FFM·
//   ],
//   [
//     [0.1410,-0.0108,0.2881,-0.0252,-6.56679847411318,0,	-0.702229221711520,	-0.883407630701375,	2.64668989180854,	1.73192410304111,	0.366338305837532, 2],    //Beef·
//     [0.1410,-0.0108,0.2881,-0.0252,-0.590224995313890,0,	0.0934750409119318,	-0.0428059183811076,	0.0580429666280133,	0.259048950474727,	0.00717699960612045, 2],    //Poultry·
//     [0.1410,-0.0108,0.2881,-0.0252,-0.237480985551221,0,	-0.0275466884513710,	0.154896735516832,	0.169751114729094,	0.296836212156808,	0.140770130860635, 4],     //CT·
//     [0.1378,-0.0017,0.3385,-0.0202,1.29537682282167,0,	0.255115678566492,	-0.115415243661154,	0.233471422343650,	-0.184374101918225,	0.0877624578307250, 3]     // Eggs·
//   ],
//   [
//     // [0.1511,-0.0352,0.1864,-0.0352,3.30703352792930,0,	-0.108647588155408,	-0.308646788805851,	0.284920262249820	,-0.133907377207774,	0.0719213014447335, 1],     //Peanut Butter
//     // [0.0507, 0.0498,0.3508, 0.0495,0,0,	0,	0.400000000000000,	0,	0,	0, 3],     //Soymilk
//     // [0.1544,-0.0134,0.3464,-0.0375,0,0,	0.587412587412588,	0	-0.349650349650350,	0.0979020979020979,	-3.01895690141170e-16,6]       //Canned Beans
//     [0.1511,-0.0352,0.1864,-0.0352,3,0.14,0.18,0.15,0.18,0.13,3.875, 1],     //Peanut Butter
//     [0.0507, 0.0498,0.3508, 0.0495,3,0.15,0.19,0.19,0.16,0.11,1.410, 3],     //Soymilk
//     [0.1544,-0.0134,0.3464,-0.0375,2,0.18,0.11,0.20,0.14,0.19,1.350, 6]       //Canned Beans
//   ]
// ];

// var Pars     = [
//   [
//     [0.0287,-0.0010,0.0535,-0.0015,-16.5178402214775,2.79508364248950/2, 2.79508364248950/2,-0.479453242578706,0.554963737373109,1.10808182780980,( -16.5178402214775+(2.79508364248950/2+ 2.79508364248950/2-0.479453242578706+0.554963737373109+1.99362694396789+1.10808182780980)*5)/2.49, 2],    //Oranges·
//     [0.0287,-0.0010,0.0535,-0.0015,-2.66175447624987,1.20106762729864/2, 1.20106762729864/2,0.574998419056799,-0.276278219836149,-0.166004705759214,( -2.66175447624987+(1.20106762729864/2+1.20106762729864/2+0.574998419056799-0.276278219836149+0.890020868450260-0.166004705759214)*5)/1.49, 2],    //Carrots·
//     [0.0287,-0.0010,0.0535,-0.0015,0.492200579505844,0.828071487686349/2, 0.828071487686349/2,-0.430594307799062,0.0877101776335659,0.501085949787469,( 0.492200579505844+(0.828071487686349/2+0.828071487686349/2-0.430594307799062+0.0877101776335659+0.442185422309038+0.501085949787469)*5)/2.49, 2],    //Tomatoes·
//     [0.0287,-0.0010,0.0535,-0.0015,0,0.941176470588241/2, 0.941176470588241/2,0.270076726342705,0,0,( 0+(0.941176470588241/2+ 0.941176470588241/2+0.270076726342705+0+0.608695652173914+0)*5)/0.485, 2],    //Bananas·
//     [0.2311,-0.0256,0.3443,-0.0291,7.46241583377826,-0.282166335872858/2, -0.282166335872858/2,-1.16520338785742,-0.300048124178850,1.27623869047736,( 7.46241583377826+(-0.282166335872858/2-0.282166335872858/2-1.16520338785742-0.300048124178850+0.939344611961531+1.27623869047736)*5)/2.31625, 5],    //CFJ·
//     [0.1455,-0.0062,0.3367,-0.0273,2.69842890949335,0.566241572059529/2, 0.566241572059529/2,0.335432030763894,0.789696747146486,-1.47023827738507,( 2.69842890949335+(0.566241572059529/2+0.566241572059529/2+0.335432030763894+0.789696747146486+0.796548752001795-1.47023827738507)*5)/2.41, 4],    // Broccoli·
//     [0.0818, 0.0057,0.1688, 0.0125,10.5031317893958,0.377988778717700/2, 0.377988778717700/2,-1.59317795728747,-0.0946196204872186,0.343697996117044,( 10.5031317893958+(0.377988778717700/2+0.377988778717700/2-1.59317795728747-0.0946196204872186+0.0425680673045816+0.343697996117044)*5)/2.0625, 3]     //Lettuce·
//   ],
//   [
//     [0.1468, 0.0047,0.3324, 0.0003,-8.12101292540831,0.959673952880220/2, 0.959673952880220/2,-0.264090443957358,0.234645049347247,1.17643109548742,(-8.12101292540831+(0.959673952880220/2+0.959673952880220/2-0.264090443957358+0.234645049347247+1.75156026822243+1.17643109548742)*5)/1.59, 3],     //Whole Wheat Tortillas·
//     [0.6882,-0.0976,0.3383, 0.0527,-24.2365143032937,2.67547522519433/2, 2.67547522519433/2,-0.734001257992270,-1.32599047296199,5.09955186474820,( -24.2365143032937+(2.67547522519433/2+2.67547522519433/2-0.734001257992270-1.32599047296199+0.596684151844762+5.09955186474820)*5)/1.99, 6],    //Oatmeal·
//     [0.6882,-0.0976,0.3383, 0.0527,-2.27571867802352,1.47739124766416/2, 1.47739124766416/2,1.17803441832167,-0.0252732388857503,-1.65340489331190,(-2.27571867802352+(1.47739124766416/2+1.47739124766416/2+1.17803441832167-0.0252732388857503+1.62626026682890-1.65340489331190)*5)/2.5, 6],    //Pasta·
//     [0.1468, 0.0047,0.3324, 0.0003,0,2.43919263933716/2, 2.43919263933716/2,0,0.309359795751240,-2.17023941422998,( 0+(2.43919263933716/2+2.43919263933716/2+0+0.309359795751240+1.08319283202466-2.17023941422998)*5)/3.334, 3],     //Whole Wheat Bread·
//     [0.6882,-0.0976,0.3383, 0.0527,0.223376623376606,1.66753246753247/2, 1.66753246753247/2,0.0961038961038945,-0.631168831168828,0.0363636363636388,( 0.223376623376606+(1.66753246753247/2+1.66753246753247/2+0.0961038961038945-0.631168831168828+0.605194805194806+0.0363636363636388)*5)/5.174, 6]     //Cereal·
//   ],
//   [
//     [0.0507, 0.0498,0.3508, 0.0495,0.679032250138045,0.760516892874893/2, 0.760516892874893/2,-1.65363877805271,-0.492109740500034,1.68378423443359,( 0.679032250138045+(0.760516892874893/2+0.760516892874893/2-1.65363877805271-0.492109740500034+1.17890255632593+1.68378423443359)*5)/1.5, 3],     //Yogurt·
//     [0.1378,-0.0017,0.3385,-0.0202,0.360765745558464,0.0777024286011066/2, 0.0777024286011066/2,0.0794917441533440,0.348541787867509,0.923035782308915,( 0.360765745558464+(0.0777024286011066/2+0.0777024286011066/2+0.0794917441533440+0.348541787867509+0.0724276224042098+0.923035782308915)*5)/3.49, 3],     // Cheese·
//     [0.0507, 0.0498,0.3508, 0.0495,-1.78676564925247,0.276095504275353/2, 0.276095504275353/2,-0.464938077185286,0.862811343585461,1.26696871281550,( -1.78676564925247+(0.276095504275353/2+ 0.276095504275353/2-0.464938077185286+0.862811343585461+0.541142257698529+1.26696871281550)*5)/ 4.99333333333333, 3]     //FFM·
//   ],
//   [
//     [0.1410,-0.0108,0.2881,-0.0252,-8.44879775005700,-0.645085006292069/2, -0.645085006292069/2,-0.730251767269410,2.44463400420597,1.52076383199750,( -8.44879775005700+(-0.645085006292069/2 -0.645085006292069/2-0.730251767269410+2.44463400420597+0.643167825139567+1.52076383199750)*5)/2.99, 2],    //Beef·
//     [0.1410,-0.0108,0.2881,-0.0252,-4.67226770222337,0.570787143013344/2, 0.570787143013344/2,-0.290511982148169,0.506507500379164,1.30432704686458,( -4.67226770222337+(0.570787143013344/2+0.570787143013344/2-0.290511982148169+0.506507500379164+0.332711387949308+1.30432704686458)*5)/5.99, 2],    //Poultry·
//     [0.1410,-0.0108,0.2881,-0.0252,-3.62536005279746,-0.229681303159829/2, -0.229681303159829/2,0.633557229120022,0.546379734655737,1.03242479753776,( -3.62536005279746+(-0.229681303159829/2 -0.229681303159829/2+0.633557229120022+0.546379734655737+0.787064621381739+1.03242479753776)*5)/1.874, 4],     //CT·
//     [0.1378,-0.0017,0.3385,-0.0202,2.25250492297000,0.908561755631141/2, 0.908561755631141/2,-0.269972910501987,0.820467576845718,-0.821134942030052,( 2.25250492297000+(0.908561755631141/2+ 0.908561755631141/2-0.269972910501987+0.820467576845718+0.703726714615167-0.821134942030052)*5)/ 2.61166666666667, 3]     // Eggs·
//   ],
//   [
//     [0.1511,-0.0352,0.1864,-0.0352,3,0.14,0.18,0.15,0.18,0.13,3.875, 1],     //Peanut Butter
//     [0.0507, 0.0498,0.3508, 0.0495,3,0.15,0.19,0.19,0.16,0.11,1.410, 3],     //Soymilk
//     [0.1544,-0.0134,0.3464,-0.0375,2,0.18,0.11,0.20,0.14,0.19,1.350, 6]       //Canned Beans
//   ]
// ];

var k_Food;

function evalSliders(iFood_unused) {
  S_actual_all.fill(0);
  for (var i = 2; i < t_max; i++) {
    k_Food = 0;
    for (i0=0; i0<food.numTypes; i0++) {                     // doesn't work if we use i,j
      for (j0=0; j0<food.numVars[i0]; j0++) {
        evalSlidersTime_i([i0,j0],i);
        k_Food += 1;
        S_actual_all[i] += z.Actual_Amount_in_Store[j_max][i];
        for (key in z) {
          if (i==t_max-1) {
            food.results[key][i0][j0] = z[key][j_max][i];
          }
          food.timeResult[key][i0][j0][i] = z[key][j_max][i];
        }
      }
    }
  }
}

function evalSlidersTime_i(iFood,i) {
  Enforcement   = sliders.currentValues[iFood[0]][iFood[1]][0][0];
  Training      = sliders.currentValues[iFood[0]][iFood[1]][0][1];
  Signage       = sliders.currentValues[iFood[0]][iFood[1]][0][2];
  S_required    = sliders.currentValues[iFood[0]][iFood[1]][0][3];
  Convenience   = sliders.currentValues[iFood[0]][iFood[1]][1][0];
  Taste         = sliders.currentValues[iFood[0]][iFood[1]][1][1];
  // Affordability = sliders.currentValues[iFood[0]][iFood[1]][1][2];
  Healthiness   = sliders.currentValues[iFood[0]][iFood[1]][1][2];
  S_infra       = sliders.currentValues[iFood[0]][iFood[1]][2][0];
  X_delivery    = sliders.currentValues[iFood[0]][iFood[1]][2][1];
  C_store       = sliders.currentValues[iFood[0]][iFood[1]][2][2];
  // C_cust        = sliders.currentValues[iFood[0]][iFood[1]][2][3];
  Par           = Pars[iFood[0]][iFood[1]];
  if (i<t_ordinance[k_Food]) {
    S_required = 0;
  }
  // runTime(Enforcement, Training, Signage, Convenience, Taste, Affordability, Healthiness, S_infra, S_required, X_delivery, C_store, Par, S_actual_all,i);
  runTime(Enforcement, Training, Signage, Convenience, Taste, Healthiness, S_infra, S_required, X_delivery, C_store, Par, S_actual_all,i);
  // console.log(j_max);
  // console.log(z.Actual_Amount_in_Store[j_max][0]);
  // console.log(S_actual_all);

  // for (key in z) {
  //   if (i==t_max-1) {
  //     food.results[key][iFood[0]][iFood[1]] = z[key][j_max][i];}
  //   for (var i = 0; i < t_max; i++) {
  //     food.timeResult[key][iFood[0]][iFood[1]][i] = z[key][j_max][i];
  //     // console.log(food.timeResult['Weekly_Profit'][0][0]);
  //   }
  // }
}

// function runTime(Enforcement,Training,Signage,Convenience,Taste,Affordability,Healthiness,S_infra,S_required,X_delivery,C_store,Par,S_actual_all,i) {
function runTime(Enforcement,Training,Signage,Convenience,Taste,Healthiness,S_infra,S_required,X_delivery,C_store,Par,S_actual_all,i) {
  let C_delivery = Par[0] + X_delivery*Par[1];
  // let C_storage = Par[2] + Par[3]*S_infra;
  // let C_total = C_delivery + C_storage + C_store;
  // let y_0        = Par[4] + Par[5]*Training      + Par[6]*Signage + Par[7]*Convenience + Par[8]*Taste
                          // + Par[9]*Affordability + Par[10]*Healthiness;
  let y_0        = Par[4] + Par[5]*Training      + Par[6]*Signage + Par[7]*Convenience + Par[8]*Taste
                          + Par[9]*Healthiness;
  let a          = 1/Par[10];
  let M_profit_max = -10000;
  // let Weekly_Consumer_Demand   = null;
  let C_cust_max = y_0*a;                        // maximum cost for the customer (x-intercept of the demand curve)
  let C_custj    = null;
  // let j_max      = null;
  // Weekly_Consumer_Demand[0] = 0;
  // z.Weekly_Amount_of_Supply[0][0] = 1;

  for (var j = 0; j < n_max; j++) {
    C_custj = C_cust_max * j / n_max;           // price for the customer
    if (C_custj > 0) {
      C_custj = C_custj;
    } else {
      C_custj = 0;
    }

    z.C_storage[j][i] = Par[2] + Par[3] * S_infra + 0.015 * S_actual_all[i - 2];
    // z.C_storage[j][i] = Par[2] + Par[3] * S_infra + 0 * S_actual_all[i - 2];
    z.Weekly_Amount_of_Supply[j][i] = Math.max(S_required * Enforcement - z.S_actual_end[j][i - 1], 0, z.Weekly_Consumer_Demand[j][i - 1] - z.S_actual_end[j][i - 1]);
    z.Actual_Amount_in_Store[j][i] = z.Weekly_Amount_of_Supply[j][i] + z.S_actual_end[j][i - 1];
    z.Weekly_Consumer_Demand[j][i] = y_0 - C_custj/a + 0.02 * S_actual_all[i - 2];
    // z.Weekly_Consumer_Demand[j][i] = y_0 - C_custj/a + 0 * S_actual_all[i - 2];
    z.Weekly_Amount_Sold[j][i] = Math.min(z.Weekly_Consumer_Demand[j][i], z.Actual_Amount_in_Store[j][i]);
    z.Weekly_Amount_Wasted[j][i] = Math.max(z.Actual_Amount_in_Store[j][i] / Par[11] - z.Weekly_Amount_Sold[j][i], 0);
    z.S_actual_end[j][i] = z.Actual_Amount_in_Store[j][i] - z.Weekly_Amount_Sold[j][i] - z.Weekly_Amount_Wasted[j][i];
    z.Weekly_Item_Cost[j][i] = z.Weekly_Amount_of_Supply[j][i] * C_store;
    z.Weekly_Storage_Cost[j][i] = z.C_storage[j][i] * z.Actual_Amount_in_Store[j][i];
    z.Weekly_Delivery_Cost[j][i] = C_delivery * z.Weekly_Amount_of_Supply[j][i];
    z.Weekly_Revenue[j][i] = C_custj * z.Weekly_Amount_Sold[j][i];
    z.Weekly_Profit[j][i] = z.Weekly_Revenue[j][i] - z.Weekly_Delivery_Cost[j][i] - z.Weekly_Storage_Cost[j][i] - z.Weekly_Item_Cost[j][i];
    z.price[j][i] = C_custj;


    // console.log(z.S_actual_end[0][0]);
    if (z.Weekly_Profit[j][i] > M_profit_max) {            // update the maximum profit
      j_max      = j;                         // index j corresponding to the maximum profit
      // console.log(j_max);
      // z.Weekly_Profit = Weekly_Profit[t_max];                  // set the z key values
      // z.Weekly_Consumer_Demand = Weekly_Consumer_Demand[t_max];
      // z.price[j]    = C_custj;
      M_profit_max = z.Weekly_Profit[j][i];
    }
    // console.log(z.Weekly_Profit);
  }
}


